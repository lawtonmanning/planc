%!TEX root = ../paper.tex

\newcommand{\lightred}{red!75}
\newcommand{\lightblue}{blue!75}
\newcommand{\offset}{.1}

\begin{tikzpicture}

% draw A
\fill[\lightred] (0,0) rectangle ++(0.5,4);
\fill[\lightblue] (0.5,0) rectangle ++(1.25,4);
\fill[\lightred] (1.75,0) rectangle ++(1.25,4);
\fill[\lightblue] (3,0) rectangle ++(1,4);
\draw[thick,dashed,xscale=4,yscale=4/3] (0,0) grid ++(1,3);
\draw[very thick] (0,0) rectangle (4,4);
\node at (2,-3*\offset) {$\M{A}$};

% draw W
\draw[fill=\lightred,shift={(-.5,0)}] (0,0) rectangle ++ (.15,4);
\draw[fill=\lightblue,shift={(-.5,0)}] (.15,0) rectangle ++ (.15,4);
\draw[thick,shift={(-.5,0)},xscale=.15,yscale=4] (0,0) grid ++(2,1);
\node at (-.5+.15,-3*\offset) {$\M{W}$};

% draw H
\draw[thick,shift={(0,4.1)},xscale=4,yscale=.15] (0,0) grid ++(1,2);
\node at (4+4*\offset,4.3) {$\M{H}^\Tra$};
\draw[fill=\lightred,shift={(0,4.1)}] (0,.15) rectangle ++(.5,.15);
\draw[fill=\lightblue,shift={(0,4.1)}] (.5,0) rectangle ++(1.25,.15);
\draw[fill=\lightred,shift={(0,4.1)}] (1.75,.15) rectangle ++(1.25,.15);
\draw[fill=\lightblue,shift={(0,4.1)}] (3,0) rectangle ++(1,.15);

\begin{scope}[shift={(-1,-6)}]
	% draw A_1 and w_1
	\draw[very thick,fill=\lightred] (0,0) rectangle ++(2.25,4);
	\draw[thick,dashed,xscale=2.25,yscale=4/3] (0,0) grid ++(1,3);
	\node at (1.125,-3*\offset) {$\M{A}_1$};
	\draw[thick,fill=\lightred] (-.5,0) rectangle ++(.15,4);
	\node at (-.5+.15,-3*\offset) {$\V{W}_1$};
	
	% draw A_2 and w_2
	\draw[very thick,fill=\lightblue] (5,0) rectangle ++(1.75,4);
	\draw[thick,dashed,shift={(5,0)},xscale=1.75,yscale=4/3] (0,0) grid ++(1,3);
	\node at (5.875,-3*\offset) {$\M{A}_2$};
	\draw[thick,,fill=\lightblue,shift={(5,0)}] (-.5,0) rectangle ++(.15,4);
	\node at (5-.5+.15,-3*\offset) {$\V{W}_2$};
\end{scope}

% draw arrows to A_1 and w_1
% TODO: make these arrows prettier
\iffalse
\draw[thick] (0.25,-\offset) parabola (.125,-0.5);
\draw[thick] (2.25,-\offset) parabola (.125,-0.5);
\draw[thick,->] (.125,-0.5) parabola (.125,-2+\offset);
\draw[thick,->] (-.5+.075,-\offset) parabola (-1.5+.075,-2+\offset);
\fi

% draw arrows from W to w_1 and w_2
\draw[thick,->] (-.5+0.15,-0.5) .. controls (-.5+0.15,-1) and (-1.5+0.075,-1)  .. (-1.5+0.075,-2+\offset);
\draw[thick,->] (-.5+0.15,-0.5) .. controls (-.5+0.15,-1) and (3.5+0.075,-1)  .. (3.5+0.075,-2+\offset);

% draw arrows to A_1
\draw[thick,->] (0.25,-\offset) .. controls (0.25,-1) and (0.125,-2+\offset) .. (0.125,-2+\offset);
\draw[thick,-] (2.5,-\offset) .. controls (2.25,-1.5) and (0.125,-1) .. (0.125,-2+\offset);

\draw[thick,->] (1,-\offset) .. controls (1,-1) and (4,-1) .. (4.875,-2+\offset);
\draw[thick,-] (3.5,-\offset) .. controls (3.5,-1) and (4,-1) .. (4.875,-2+\offset);

% draw arrows to A_2
% TODO: make these arrows prettier
\iffalse
\draw[thick] (1,-\offset) parabola (4.375,-0.5);
\draw[thick] (3.5,-\offset) parabola (4.375,-0.5);
\draw[thick,->] (4.375,-0.5) parabola (4.875,-2+\offset);
\draw[thick,->] (-.5+.225,-\offset) parabola (3.5+.075,-2+\offset);
\fi

\end{tikzpicture}
